{
  "code": "import PointsManager from \"../manager/PointsManager\";\r\n{\r\n    itemType;\r\n}\r\nfrom;\r\n\"../components/Item\";\r\nimport Events from \"../events/events\";\r\nimport utils from \"../utils/utils\";\r\nexport default class WindowHistory extends fgui.Window {\r\n    constructor() {\r\n        super();\r\n        this._isAll = false;\r\n    }\r\n    onInit() {\r\n        this.contentPane = fgui.UIPackage.createObject(\"canvas\", \"window_1\").asCom;\r\n        this.center();\r\n        this.setPivot(0.5, 0.5);\r\n        this.contentPane.getChild(\"btn_close\").onClick(this, this.onHide);\r\n        this._list = this.contentPane.getChild(\"n3\").asList;\r\n        this._list.scrollItemToViewOnClick = false;\r\n        this._btnSelect = this.contentPane.getChild(\"n12\").asButton;\r\n        this.contentPane.getChild(\"n4\").asButton.onClick(this, this.addGroup);\r\n        this._btnSelect.onClick(this, this.selectAll);\r\n        this.contentPane.getChild(\"n19\").asButton.onClick(this, this.deleteAll);\r\n    }\r\n    onShown() {\r\n        this.initList();\r\n        Laya.stage.on(Events.DELETE_ITEM, this, this.deleteItem);\r\n    }\r\n    initList() {\r\n        this._list.removeChildrenToPool();\r\n        for (var i = 0; i < PointsManager.historyData.length; i++) {\r\n            const element = PointsManager.historyData[i];\r\n            var item = this._list.addItemFromPool();\r\n            item.title = element.label.length > 6 ? element.label.substr(0, 6) + \"...\" : element.label;\r\n            item.time = element.timestamp || \"-\";\r\n            item._uuid = element[\"uuid\"];\r\n            item.type = itemType.HISTORY;\r\n        }\r\n    }\r\n    deleteItem(evt) {\r\n        this._list.removeChildToPool(evt);\r\n        utils.spliceByKey(PointsManager.historyData, \"uuid\", evt._uuid);\r\n        PointsManager.saveHistory();\r\n    }\r\n    addGroup() {\r\n        const name = this.contentPane.getChild(\"n6\").asTextField.text;\r\n        if (!name) {\r\n            alert(\"请先为字符组起个名字吧！\");\r\n            return;\r\n        }\r\n        const length = this._list._children.length;\r\n        if (length == 0) {\r\n            alert(\"你好像还没有什么历史记录哦~\");\r\n            return;\r\n        }\r\n        let pointsItem = [];\r\n        for (let i = 0; i < length; i++) {\r\n            let item = this._list.getChildAt(i);\r\n            if (item.selected) {\r\n                const points = utils.findByKey(PointsManager.historyData, \"uuid\", item[\"_uuid\"]);\r\n                pointsItem.push({ \"label\": points['label'], \"points\": points[\"points\"] });\r\n            }\r\n        }\r\n        if (pointsItem.length == 0) {\r\n            alert(\"请至少选择一个字符数据！\");\r\n            return;\r\n        }\r\n        PointsManager.groupData.push({ \"name\": name, \"data\": pointsItem });\r\n        PointsManager.saveGroup();\r\n        Laya.stage.event(Events.DATA_INIT);\r\n        alert(\"创建成功！\");\r\n    }\r\n    selectAll() {\r\n        this._isAll = !this._isAll;\r\n        this.updateList(this._isAll);\r\n    }\r\n    deleteAll() {\r\n        this._list.removeChildrenToPool();\r\n        PointsManager.historyData = [];\r\n        PointsManager.saveHistory();\r\n    }\r\n    updateList(bool = false) {\r\n        for (let i = 0; i < this._list._children.length; i++) {\r\n            let item = this._list.getChildAt(i);\r\n            item.selected = bool;\r\n        }\r\n    }\r\n    doShowAnimation() {\r\n        this.setScale(0.1, 0.1);\r\n        fgui.GTween.to2(0.1, 0.1, 1, 1, 0.3)\r\n            .setTarget(this, this.setScale)\r\n            .setEase(fgui.EaseType.QuadOut)\r\n            .onComplete(this.onShown, this);\r\n    }\r\n    doHideAnimation() {\r\n        fgui.GTween.to2(1, 1, 0.1, 0.1, 0.3)\r\n            .setTarget(this, this.setScale)\r\n            .setEase(fgui.EaseType.QuadOut)\r\n            .onComplete(this.hideImmediately, this);\r\n    }\r\n    onHide() {\r\n        Laya.stage.off(Events.DELETE_ITEM, this, this.deleteItem);\r\n        this.updateList(false);\r\n        this.hide();\r\n    }\r\n}\r\n",
  "references": [
    "E:/coding/layabox/Super-Quick-Recognizer/src/manager/PointsManager.ts",
    "E:/coding/layabox/Super-Quick-Recognizer/src/events/events.ts",
    "E:/coding/layabox/Super-Quick-Recognizer/src/utils/utils.ts"
  ]
}
