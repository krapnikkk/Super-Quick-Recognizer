'use strict';var ota={TAB:0,Hk:1,Ko:2},Y$=function(a){Db("MediaRouter.WebRtc.Start.Success",a,ota)};var Z$=function(a,c){xj.call(this,c);this.C=a;this.h=new Eb;this.b=Xv(c.id);this.w=new Eb;this.D=!1;this.l=null;this.u=!1;this.o=this.j=null;pta(this);qta(this);this.b.sendMessage(new Dj("GET_TURN_CREDENTIALS"))};q(Z$,xj);
Z$.prototype.start=function(a){var c=this;return this.h.b.then(function(b){if(b.b)return Promise.reject(new Bi("Mirroring already started"));if(c.l)return Promise.reject(new Bi("Session permanently stopped"));c.j=new sb("MediaRouter.WebRtc.Session.Launch");b.ga.addStream(a);b.start();return c.w.b})};
Z$.prototype.stop=function(){var a=this;this.w.reject(new Bi("Session stop requested."));this.o&&(this.o.end(),this.o=null);if(this.l)return this.l;this.u=this.D=!1;this.j=null;return this.l=this.h.b.then(function(c){c.stop()}).then(function(){return a.b.fb()}).catch(function(c){a.b.fb();throw c;})};
var pta=function(a){a.b.onMessage=function(c){if(!c.type)throw Error("Message has no type.");switch(c.type){case "TURN_CREDENTIALS":a.h.resolve(new Ij(a.f.id,c.data.credentials));break;case "ANSWER":a.h.b.then(function(b){Qj(b,c.data)});break;case "KNOCK_ANSWER":a.u=!0;a.h.b.then(function(b){Qj(b,c.data)});break;case "STOP":a.w.reject(new Bi("Stop signal received"));a.stop();break;default:throw new Bi("Unknown message type: "+c.type);}}},qta=function(a){a.h.b.then(function(c){Mj(c,function(b){a.b.sendMessage(new Dj("OFFER",
new Fj(b,a.C,Gj)))});Nj(c,function(b){b=Ej(b);a.b.sendMessage(b)});Jj(c,function(){a.D=!0;a.b.sendMessage(new Dj("SESSION_START_SUCCESS"));!a.u&&a.j&&a.j.end();a.j=null;a.o=new zb("MediaRouter.WebRtc.Session.Length");a.w.resolve(a)});Lj(c,function(){a.b.sendMessage(new Dj("SESSION_END"))});Kj(c,function(b){a.D||a.w.reject(b);a.b.sendMessage(new Dj("SESSION_FAILURE"))})})};var $$=function(){mj.call(this,"webrtc")};q($$,mj);h=$$.prototype;h.zh=function(a,c){return new Z$(a,c)};h.gh=function(){Y$(0)};h.dh=function(){Y$(1)};h.bi=function(){Y$(2)};h.eh=function(){Cb("MediaRouter.WebRtc.Session.End")};h.fg=function(a){Db("MediaRouter.WebRtc.Start.Failure",a,Ai)};h.fh=function(){Cb("MediaRouter.WebRtc.Stream.End")};var rta=new $$;cj("mr.mirror.webrtc.WebRtcService",rta);
