!function(){"use strict";class t{}t.DELETE_ITEM="delete_item",t.DATA_INIT="data_init",t.INSERT_FILE_DATA="insert_file_data",t.PREVIEW_DATA="preview_data";class e{static round(t,e){return e=Math.pow(10,e),Math.round(t*e)/e}static rand(t,e){return Math.floor((e-t+1)*Math.random())+t}static roundColor(){return"rgb("+e.rand(0,200)+","+e.rand(0,200)+","+e.rand(0,200)+")"}static copyText(t){if(""!==t){var e=document.querySelector(".oInput");e||((e=document.createElement("input")).className="oInput",document.body.appendChild(e)),e.style.display="block",e.value=t,e.select(),document.execCommand("Copy"),e.style.display="none",alert("内容已经复制到黏贴板啦")}else alert("好像没有需要复制的内容哦！")}static setItem(t,e){localStorage.setItem(t,e)}static getItem(t){return localStorage.getItem(t)}static spliceByKey(t,e,i){for(let s=0;s<t.length;s++){const a=t[s];a[e]&&a[e]==i&&t.splice(s,1)}}static spliceArrayByKey(t,e,i,s,a){const o=t[i][e];for(let t=0;t<o.length;t++){const e=o[t];e[s]&&e[s]==a&&o.splice(t,1)}}static findByKey(t,e,i){for(let s=0;s<t.length;s++){const a=t[s];if(a[e]&&a[e]==i)return a}}}class i{static saveHistory(){e.setItem("history",JSON.stringify(i.historyData))}static saveGroup(t){const s=t||i.groupData;e.setItem("group",JSON.stringify(s))}static insertData(t){if(t)try{const e=JSON.parse(t);if(!e.name||!e.data)throw new Error;for(let t=0,i=e.data.length;t<i;t++){const i=e.data[t];if(!i.label||!i.points)throw new Error;for(let t=0,e=i.points.length;t<e;t++){const e=i.points[t];if(!(e.X&&e.Y&&e.ID))throw new Error}}i.groupData.push(e),i.saveGroup(),alert("导入成功！")}catch(t){alert("文件内容json格式有误！")}}}var s;i.recognizer=new $Q.QDollarRecognizer,i.pointClouds=i.recognizer.PointClouds,i.groupData=[],i.historyData=[],i.previewData=[],i.currentGroupIndex=0,function(t){t.HISTORY="HISTORY",t.GROUP="GROUP"}(s||(s={}));class a extends fgui.GComponent{constructor(){super(),this._selected=!1}constructFromXML(t){super.constructFromXML(t),this._titleGC=this.getChild("n1").asTextField,this._timeGC=this.getChild("n2").asTextField,this._btnSelect=this.getChild("n6").asButton,this._btnSelect.onClick(this,this.selectItem),this.getChild("n7").onClick(this,this.viewItem),this.getChild("n8").onClick(this,this.deleteItem)}set type(t){this._type=t}set title(t){this._title=t,this._titleGC.text=t}get title(){return this._title}set time(t){this._time=t,this._timeGC.text=t}get time(){return this._time}set selected(t){this._btnSelect.selected=this._selected=t}get selected(){return this._selected}selectItem(){this._selected=this._btnSelect.selected}deleteItem(){Laya.stage.event(t.DELETE_ITEM,this)}viewItem(){let e=[];e=this._type==s.HISTORY?i.historyData:i.groupData[i.currentGroupIndex].data;for(let t=0;t<e.length;t++){const s=e[t];if(s.uuid==this._uuid){i.previewData=s.points;break}}Laya.stage.event(t.PREVIEW_DATA,null)}}class o{constructor(){}static init(){fgui.UIObjectFactory.setExtension("ui://canvas/item",a)}}o.width=Laya.Browser.clientWidth,o.height=Laya.Browser.clientHeight,o.scaleMode="noscale",o.screenMode="none",o.alignV="top",o.alignH="left",o.startScene="",o.sceneRoot="",o.debug=!1,o.stat=!1,o.physicsDebug=!1,o.exportSceneToJson=!0,o.init();class n extends fgui.Window{constructor(){super(),this._isAll=!1}onInit(){this.contentPane=fgui.UIPackage.createObject("canvas","window_1").asCom,this.center(),this.setPivot(.5,.5),this.contentPane.getChild("btn_close").onClick(this,this.onHide),this._list=this.contentPane.getChild("n3").asList,this._list.scrollItemToViewOnClick=!1,this._btnSelect=this.contentPane.getChild("n12").asButton,this.contentPane.getChild("n4").asButton.onClick(this,this.addGroup),this._btnSelect.onClick(this,this.selectAll),this.contentPane.getChild("n19").asButton.onClick(this,this.deleteAll)}onShown(){this.initList(),Laya.stage.on(t.DELETE_ITEM,this,this.deleteItem)}initList(){this._list.removeChildrenToPool();for(var t=0;t<i.historyData.length;t++){const a=i.historyData[t];var e=this._list.addItemFromPool();e.title=a.label.length>6?a.label.substr(0,6)+"...":a.label,e.time=a.timestamp||"-",e._uuid=a.uuid,e.type=s.HISTORY}}deleteItem(t){this._list.removeChildToPool(t),e.spliceByKey(i.historyData,"uuid",t._uuid),i.saveHistory()}addGroup(){const s=this.contentPane.getChild("n6").asTextField.text;if(!s)return void alert("请先为字符组起个名字吧！");const a=this._list._children.length;if(0==a)return void alert("你好像还没有什么历史记录哦~");let o=[];for(let t=0;t<a;t++){let s=this._list.getChildAt(t);if(s.selected){const t=e.findByKey(i.historyData,"uuid",s._uuid);o.push({label:t.label,points:t.points})}}0!=o.length?(i.groupData.push({name:s,data:o}),i.saveGroup(),Laya.stage.event(t.DATA_INIT),alert("创建成功！")):alert("请至少选择一个字符数据！")}selectAll(){this._isAll=!this._isAll,this.updateList(this._isAll)}deleteAll(){this._list.removeChildrenToPool(),i.historyData=[],i.saveHistory()}updateList(t=!1){for(let e=0;e<this._list._children.length;e++){this._list.getChildAt(e).selected=t}}doShowAnimation(){this.setScale(.1,.1),fgui.GTween.to2(.1,.1,1,1,.3).setTarget(this,this.setScale).setEase(fgui.EaseType.QuadOut).onComplete(this.onShown,this)}doHideAnimation(){fgui.GTween.to2(1,1,.1,.1,.3).setTarget(this,this.setScale).setEase(fgui.EaseType.QuadOut).onComplete(this.hideImmediately,this)}onHide(){Laya.stage.off(t.DELETE_ITEM,this,this.deleteItem),this.updateList(!1),this.hide()}}class h extends fgui.Window{constructor(){super()}onInit(){this.contentPane=fgui.UIPackage.createObject("canvas","window_2").asCom,this.center(),this.setPivot(.5,.5),this.contentPane.getChild("btn_close").onClick(this,this.onHide),this._comboBox=this.contentPane.getChild("n17").asComboBox,this._comboBox.on(fairygui.Events.STATE_CHANGED,this,this.onComboBoxChanged),this._list=this.contentPane.getChild("n3").asList,this._list.scrollItemToViewOnClick=!1,this.contentPane.getChild("n20").asButton.onClick(this,this.deleteGroup),this.contentPane.getChild("n19").asButton.onClick(this,this.exportData),this.contentPane.getChild("n4").asButton.onClick(this,this.importData)}onShown(){this.initComboBox(),Laya.stage.on(t.DELETE_ITEM,this,this.deleteItem)}initComboBox(){Laya.stage.event(t.DATA_INIT),this._comboBox.items=[],this._comboBox.values=[];let e=[],s=[],a=i.groupData.length;if(a){for(let t=0;t<a;t++)e.push(i.groupData[t].name),s.push(t);this._comboBox.items=e,this._comboBox.values=s,this.initList()}else alert("数据组好像木有数据了哦！")}onComboBoxChanged(){i.currentGroupIndex=+this._comboBox.value,this.initList()}initList(){if(this._list.removeChildrenToPool(),!i.groupData.length)return;const t=i.groupData[i.currentGroupIndex].data;for(var e=0;e<t.length;e++){const i=t[e],o=(new Date).getTime()+e;var a=this._list.addItemFromPool();a.title=i.label.length>6?i.label.substr(0,6)+"...":i.label,a.time=i.timestamp||"组内数据不记录时间",a._uuid=i.uuid=o,a.type=s.GROUP}}deleteGroup(){i.groupData.splice(i.currentGroupIndex,1),i.saveGroup(),i.groupData.length>0?(alert(`数据组：【${this._comboBox.text}】已成功删除！`),this.initComboBox()):alert("数据组好像木有数据了哦！")}deleteItem(t){this._list.removeChildToPool(t),e.spliceArrayByKey(i.groupData,"data",i.currentGroupIndex,"uuid",t._uuid);const s=Object.assign([],i.groupData);for(let t=0;t<s.length;t++){const e=s[t];for(let t=0;t<e.data.length;t++){const i=e.data[t];i.uuid&&delete i.uuid}}i.saveGroup(s)}exportData(){const t=i.groupData[i.currentGroupIndex];t.data.map((t,e)=>{t.uuid&&(delete t.uuid,t.points.map((t,e)=>{t.X=Math.trunc(t.X),t.Y=Math.trunc(t.Y)}))}),e.copyText(JSON.stringify(t).replace(/"IntX":0,"IntY":0,/g,""))}importData(){let t=this.contentPane.getChild("n30").text;i.insertData(t),this.initComboBox()}doShowAnimation(){this.setScale(.1,.1),fgui.GTween.to2(.1,.1,1,1,.3).setTarget(this,this.setScale).setEase(fgui.EaseType.QuadOut).onComplete(this.onShown,this)}doHideAnimation(){fgui.GTween.to2(1,1,.1,.1,.3).setTarget(this,this.setScale).setEase(fgui.EaseType.QuadOut).onComplete(this.hideImmediately,this)}onHide(){this.hide(),Laya.stage.off(t.DELETE_ITEM,this,this.deleteItem)}}class l extends fgui.Window{constructor(){super()}onInit(){this.contentPane=fgui.UIPackage.createObject("canvas","canvas").asCom,this.center(),this.setPivot(.5,.5),this.contentPane.getChild("n2").onClick(this,this.onHide),this._canvas=this.contentPane.getChild("n1").asGraph}onShown(){this.autoDraw()}autoDraw(){this._canvas.displayObject.graphics.clear(!1),this._canvas.displayObject.graphics.drawRect(0,0,this._canvas.width,this._canvas.height,"#ffffff");let t=i.previewData[0].X,s=i.previewData[0].Y,a=i.previewData.length,o=0,n=e.roundColor();for(let h=1;h<a-1;h++){const a=i.previewData[h],l=a.X,r=a.Y;o!=a.ID?(o++,n=e.roundColor()):function(t,e,i,s,a,o,n){window.setTimeout(()=>{t.drawLine(e,i,s,a,n,2)},10*o)}(this._canvas.displayObject.graphics,t,s,l,r,h,n),t=l,s=r}}doShowAnimation(){this.setScale(.1,.1),fgui.GTween.to2(.1,.1,1,1,.3).setTarget(this,this.setScale).setEase(fgui.EaseType.QuadOut).onComplete(this.onShown,this)}doHideAnimation(){fgui.GTween.to2(1,1,.1,.1,.3).setTarget(this,this.setScale).setEase(fgui.EaseType.QuadOut).onComplete(this.hideImmediately,this)}onHide(){this.hide()}}class r{constructor(){this._groupName="",this.preX=0,this.preY=0,this.curX=0,this.curY=0,this._points=[],this._strokeID=0,this._strokeColor="",this.touchMoveable=!0,this.hasRecognize=!1,fgui.UIPackage.loadPackage("res/ui/canvas",Laya.Handler.create(this,this.onUILoaded))}onUILoaded(){this._view=fgui.UIPackage.createObject("canvas","Main").asCom,this._view.x=(Laya.Browser.clientWidth-this._view.width)/2,fgui.GRoot.inst.addChild(this._view),this._canvas=this._view.getChild("canvas"),this._canvas.on("mousedown",this,this.touchStart),this._btnClear=this._view.getChild("n26"),this._btnClear.onClick(this,this.canvasClear),this._btnRecognize=this._view.getChild("n25"),this._btnRecognize.onClick(this,this.recognize),this._textResult=this._view.getChild("text_result"),this._textData=this._view.getChild("n10"),this._textName=this._view.getChild("name"),this._textGroup=this._view.getChild("text_group").asTextField,this._btnCopy=this._view.getChild("btn_copy"),this._btnCopy.on("mousedown",this,this.copyText),this._btnAdd=this._view.getChild("btn_add"),this._btnAdd.on("mousedown",this,this.addText),this._comboBox=this._view.getChild("type").asComboBox,this._comboBox.on(fairygui.Events.STATE_CHANGED,this,this.onComboBoxChanged),this._view.getChild("n31").onClick(this,this._clickWindowA),this._view.getChild("n34").onClick(this,this._clickWindowB),this.onDataInit(),Laya.stage.on(t.DATA_INIT,this,this.onDataInit),Laya.stage.on(t.PREVIEW_DATA,this,this.showCanvas)}onDataInit(){let t=JSON.parse(e.getItem("group"));t&&t.length?(i.groupData=t,i.historyData=JSON.parse(e.getItem("history"))||[],this.initComboBox(),this.initData(0)):Laya.loader.load("res/config/group.json",Laya.Handler.create(this,this.onDataLoaded))}onDataLoaded(t){i.groupData=t,i.saveGroup(),this.initComboBox(),this.initData(0)}initComboBox(){this._comboBox.items=[],this._comboBox.values=[];let t=[],e=[];for(let s=0;s<i.groupData.length;s++)t.push(i.groupData[s].name),e.push(s);this._comboBox.items=t,this._comboBox.values=e}initData(t=0){let e=i.groupData[t],s=e.data;this._groupName=e.name,this._textGroup.setVar("group",this._groupName).flushVars(),i.recognizer.PointClouds=[];for(let t=0;t<s.length;t++){const e=s[t].points,a=s[t].label;i.recognizer.PointClouds.push(new $Q.PointCloud(a,e))}}onComboBoxChanged(){this.initData(+this._comboBox.value)}touchStart(t){this.hasRecognize&&(this.hasRecognize=!1,this.canvasClear()),this._strokeColor=e.roundColor(),this._strokeID++,this._textData.text="",this._textResult.visible=!1,this.preX=t.target.mouseX,this.preY=t.target.mouseY,this.touchMoveable=!0,this._points.push(new $Q.Point(this.preX,this.preY,this._strokeID)),this._canvas.on("mousemove",this,this.touchMove),this._canvas.on("mouseup",this,this.touchEnd),this._view.on("mousemove",this,this.checkTouchRect)}checkTouchRect(t){t.target==this._view.displayObject&&(this.touchMoveable=!1)}touchMove(t){if(!this.touchMoveable)return this._canvas.off("mousemove",this,this.touchMove),void this._canvas.off("mouseup",this,this.touchEnd);this.curX=t.target.mouseX,this.curY=t.target.mouseY,this._points.push(new $Q.Point(this.curX,this.curY,this._strokeID)),this._canvas.displayObject.graphics.drawLine(this.preX,this.preY,this.curX,this.curY,this._strokeColor,2),this.preX=this.curX,this.preY=this.curY}touchEnd(t){console.log(this._points),this._canvas.off("mousemove",this,this.touchMove),this._canvas.off("mouseup",this,this.touchEnd)}canvasClear(){this._textData.text="",this._textResult.visible=!1,this._strokeID=0,this._points=[],this._canvas.displayObject.graphics.clear(!1),this._canvas.displayObject.graphics.drawRect(0,0,this._canvas.width,this._canvas.height,"#ffffff")}recognize(){if(this.hasRecognize=!0,this._textData.text=JSON.stringify(this._points).replace(/"IntX":0,"IntY":0,/g,""),this._points.length>=10){var t=i.recognizer.Recognize(this._points);this._textResult.visible=!0,this._textResult.setVar("text",t.Name).setVar("time",t.Time+"").setVar("score",e.round(t.Score,2)+"").flushVars()}else alert("你好像还没有画什么东西或者绘制的点太少啦！")}copyText(){e.copyText(this._textData.text)}addText(){0!=this._points.length?""!=this._textName.text?(i.historyData.push({label:this._textName.text,points:this._points,timestamp:(new Date).toLocaleString(),uuid:(new Date).getTime()}),i.saveHistory(),i.recognizer.AddGesture(this._textName.text,this._points),alert("添加成功！")):alert("请为该数据命个名吧~"):alert("请先绘制点东西吧~")}_clickWindowA(){null==this._winA&&(this._winA=new n,this._winA.modal=!0),this._winB&&this._winB.hide(),this._winA.show()}_clickWindowB(){null==this._winB&&(this._winB=new h,this._winB.modal=!0),this._winA&&this._winA.hide(),this._winB.show()}showCanvas(){null==this._canvasPanel&&(this._canvasPanel=new l,this._canvasPanel.modal=!0),this._canvasPanel.show()}}new class{constructor(){window.Laya3D?Laya3D.init(o.width,o.height):Laya.init(o.width,o.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=o.scaleMode,Laya.stage.screenMode=o.screenMode,Laya.stage.alignV=o.alignV,Laya.stage.alignH=o.alignH,Config.isAntialias=!0,Laya.URL.exportSceneToJson=o.exportSceneToJson,(o.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),o.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),o.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Laya.stage.addChild(fgui.GRoot.inst.displayObject),new r}}}();